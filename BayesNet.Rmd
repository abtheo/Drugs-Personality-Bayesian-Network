---
title: "Drug Consumption & Personality Types"
output: html_notebook
---
<hr/>
Bayesian statistics, armchair psychology, and a whole load of drugs. Move over Sigmund Freud.


<h2>Dataset Description</h2>

The dataset contains records for 1885 respondents. For each respondent 12 attributes are known: Personality measurements which include NEO-FFI-R (neuroticism, extraversion, openness to experience, agreeableness, and conscientiousness), BIS-11 (impulsivity), and ImpSS (sensation seeking), level of education, age, gender, country of residence and ethnicity. All input attributes are originally categorical and are quantified. After quantification values of all input features can be considered as real-valued. In addition, participants were questioned concerning their use of 18 legal and illegal drugs (alcohol, amphetamines, amyl nitrite, benzodiazepine, cannabis, chocolate, cocaine, caffeine, crack, ecstasy, heroin, ketamine, legal highs, LSD, methadone, mushrooms, nicotine and volatile substance abuse and one fictitious drug (Semeron) which was introduced to identify over-claimers. For each drug they have to select one of the answers: never used the drug, used it over a decade ago, or in the last decade, year, month, week, or day.
Database contains 18 classification problems. Each of independent label variables contains seven classes: "Never Used", "Used over a Decade Ago", "Used in Last Decade", "Used in Last Year", "Used in Last Month", "Used in Last Week", and "Used in Last Day".


Detailed description of database and process of data quantification are presented in E. Fehrman, A. K. Muhammad, E. M. Mirkes, V. Egan and A. N. Gorban, "The Five Factor Model of personality and evaluation of drug consumption risk.," arXiv, 2015.



<i>Dataset available at: http://archive.ics.uci.edu/ml/datasets/Drug+consumption+%28quantified%29#</i>

```{r Dependencies, message=FALSE, warning=FALSE, include=FALSE}
install.packages("remotes")
remotes::install_github("jtextor/bayesianNetworks")
library( bayesianNetworks )

library(tools)
install.packages("bnlearn")
library( bnlearn )
library(readr)
install.packages("tidyr")
install.packages("dplyr")
library(dplyr)
library(tidyr)


install.packages('dagitty')
library(dagitty)
install.packages('ggplot2')
library(ggplot2)
install.packages("ggridges")
library(ggridges)
```

<h2>Import Dataset</h2>
<hr/>
```{r}
# Import the data and look at the first six rows
df <- read_csv("drug_consumption.csv")
#,col_types=paste("i", strrep("f",31),sep="")
head(df)
```
<h1>Exploratory Data Analysis</h1>
<hr/>
First off, let's get to know our dataset a little better. Of particular importance when working with Bayesian statistics is to investigate the number of classes per feature. Each class increases the number of model parameters, but moreover, we must ensure a sufficient number of samples are available in each case. When we lack samples, as often with the Personality Trait features, we can mitigate group classes up to a higher aggregation level.

<h2>Occurrence Table</h2>  
Quick example, print the number of occurrences of each class for a couple of the features. Obviously the more classes a feature has, the fewer occurrences there will be per class, roughly following a Gaussian distribution.
```{r}
sapply(df[c("Gender","Age", "Openness")], ftable)
```
<h2>Kernel Density Estimation</h2>
We can plot an estimated probability density function by fitting a Gaussian kernel to each observation. Using ggridges package for a nice way to glance over the distribution of many features at a time.
```{r}
df %>% 
  ggplot(aes(Impulsiveness, as.factor(Alcohol))) +
  geom_density_ridges(alpha = 0.5, bandwidth = 0.18, fill = "red") +
  labs(y="Alcohol Use", title = "Alcohol Use vs. Impulsiveness")  +
  theme_ridges(center_axis_labels=TRUE, grid=FALSE)

df %>% 
  ggplot(aes(Openness, as.factor(Cannabis))) +
  geom_density_ridges(alpha = 0.5, bandwidth = 0.18, fill = "green") +
  labs(y = "Cannabis Use", title = "Cannabis Use vs. Openness")  +
  theme_ridges(center_axis_labels=TRUE, grid=FALSE)

```


<h1>Fitting Models from Data</h1>
The connections present in a Bayesian Network drawn from the dataset can lend insights into the   relationships between variables. Note that taking different subsets of features will result in starkly different graphs, often causing relationships between specific nodes to invert or disappear. This limits the investigative usefulness of such a model, however we believe it still holds some informative value. To mitigate these problems, we split our features into rigid semantic groups in the section below.

We will ultimately define a custom network configuration, and encode causal direction according to our own logical determinations about the reality of the situation, rather than naively trusting our data.

```{r}
df <- read_csv("drug_consumption.csv")
#Take a subset of the data for a smaller example network
cols <- c("Age","Ecstacy", "Extraversion")
data <- df[cols]
#data[cols] <- lapply(df[cols], factor)
#Aggregate personality value levels

#data$Extraversion <- cut(df$Extraversion, breaks=4, labels=seq_len(4))

#Split train-test
smp_size <- floor(0.75 * nrow(data))
train_ind <- sample(seq_len(nrow(data)), size = smp_size)

train_data <- data[train_ind, ]
test_data <- data[-train_ind, ]

fit <-pc.stable(train_data)
plot(fit)


```
<h2>Semantic Segregation</h2>
There are three clearly distinct categories of feature found within our dataset:

  <ul>
    <li>
      Facts: we wish to condition our model on these variables. We know there is no causal relationship between the  other two categories which will influence these variables. Conversely, they will likely have an influence on the majority of variables from the other two categories, so adjusting for them will be necessary.
    </li>
    <li>
      Personalities: observations which are the focus of this project. 
    </li>
    <li>
      Drugs:
    </li>
  </ul>


<h3>Facts</h3>
```{r}
facts = c("Age",
           "Gender",
           "Country",
           "Ethnicity",
           "Education")

fit <-pc.stable(df[facts])
plot(fit)
```
These results seem sensible. Age, Gender & Ethnicity all have no parent nodes as we'd hope.

However, there do seem to be extraneous relationships being drawn; in particular, Country counter-intuitively appears to be the child of every other node.

<h3>Personalities</h3>
```{r}
personalities = c("Extraversion", 
                  "Neuroticism", 
                  "Openness",
                  "Agreeableness",
                  "Conscientiousness",
                  "Impulsiveness",
                  "SensationSeeking")


fit <-pc.stable(df[personalities])
plot(fit)
```

<h3>Drugs</h3>
```{r}
drugs = c("Alcohol",
          "Amphetamines",
          "AmylNitrate",
          "Benzos",
          "Caffeine",
          "Cannabis",
          "Chocolate",
          "Cocaine",
          "Crack",
          "Ecstacy",
          "Heroin",
          "Ketamine",
          "LegalHighs",
          "LSD",
          "Meth",
          "Mushrooms",
          "Nicotine",
          "Semeron", 
          "VSA")

fit <-pc.stable(df[drugs])
plot(fit)
```
Wow, that's a fair few connections! 


<h1>Bayesian Network</h1>
```{r}
testImplications <- function( covariance.matrix, sample.size ){
	library(ggm)
	tst <- function(i){ pcor.test( pcor(i,covariance.matrix), length(i)-2, sample.size )$pvalue }
tos <- function(i){ paste(i,collapse=" ") }
implications <- list(c("Neuroticism","Extraversion"),
		c("Neuroticism","Openness"),
		c("Neuroticism","Agreeableness"),
		c("Neuroticism","Conscientiousness"),
		c("Neuroticism","Impulsiveness"),
		c("Neuroticism","SensationSeeking"),
		c("Extraversion","Openness"),
		c("Extraversion","Agreeableness"),
		c("Extraversion","Conscientiousness"),
		c("Extraversion","Impulsiveness"),
		c("Extraversion","SensationSeeking"),
		c("Openness","Agreeableness"),
		c("Openness","Conscientiousness"),
		c("Openness","Impulsiveness"),
		c("Openness","SensationSeeking"),
		c("Agreeableness","Conscientiousness"),
		c("Agreeableness","Impulsiveness"),
		c("Agreeableness","SensationSeeking"),
		c("Conscientiousness","Impulsiveness"),
		c("Conscientiousness","SensationSeeking"),
		c("Impulsiveness","SensationSeeking"),
		c("Alcohol","Amphetamines","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","AmylNitrate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Benzos","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Caffeine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Cannabis","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Chocolate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Alcohol","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","AmylNitrate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Benzos","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Caffeine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Cannabis","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Chocolate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Amphetamines","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Benzos","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Caffeine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Cannabis","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Chocolate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("AmylNitrate","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Caffeine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Cannabis","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Chocolate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Benzos","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Cannabis","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Chocolate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Caffeine","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Chocolate","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cannabis","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Cocaine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Chocolate","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Crack","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Cocaine","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Ecstacy","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Crack","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","Heroin","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ecstacy","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","Ketamine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Heroin","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","LegalHighs","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Ketamine","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LegalHighs","LSD","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LegalHighs","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LegalHighs","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LegalHighs","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LegalHighs","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LegalHighs","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LSD","Meth","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LSD","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LSD","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LSD","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("LSD","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Meth","Mushrooms","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Meth","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Meth","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Meth","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Mushrooms","Nicotine","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Mushrooms","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Mushrooms","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Nicotine","Semeron","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Nicotine","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"),
		c("Semeron","VSA","Agreeableness","Neuroticism","Conscientiousness","Openness","SensationSeeking","Impulsiveness","Extraversion"))
data.frame( implication=unlist(lapply(implications,tos)),
		pvalue=unlist( lapply( implications, tst ) ) )

}
```

```{r}

graph <- dagitty('
dag {
bb="0,0,1,1"
Agreeableness [exposure,pos="0.265,0.362"]
Alcohol [outcome,pos="0.141,0.720"]
Amphetamines [outcome,pos="0.089,0.665"]
AmylNitrate [outcome,pos="0.669,0.667"]
Benzos [outcome,pos="0.187,0.661"]
Caffeine [outcome,pos="0.228,0.721"]
Cannabis [outcome,pos="0.267,0.656"]
Chocolate [outcome,pos="0.570,0.700"]
Cocaine [outcome,pos="0.596,0.622"]
Conscientiousness [exposure,pos="0.432,0.353"]
Crack [outcome,pos="0.854,0.669"]
Ecstacy [outcome,pos="0.400,0.703"]
Extraversion [exposure,pos="0.759,0.346"]
Heroin [outcome,pos="0.315,0.710"]
Impulsiveness [exposure,pos="0.682,0.348"]
Ketamine [outcome,pos="0.487,0.687"]
LSD [outcome,pos="0.789,0.673"]
LegalHighs [outcome,pos="0.517,0.621"]
Meth [outcome,pos="0.913,0.661"]
Mushrooms [outcome,pos="0.958,0.659"]
Neuroticism [exposure,pos="0.346,0.363"]
Nicotine [outcome,pos="0.740,0.669"]
Openness [exposure,pos="0.514,0.356"]
Semeron [outcome,pos="0.439,0.638"]
SensationSeeking [exposure,pos="0.594,0.354"]
VSA [outcome,pos="0.357,0.653"]
Agreeableness -> Alcohol
Agreeableness -> Amphetamines
Agreeableness -> AmylNitrate
Agreeableness -> Benzos
Agreeableness -> Caffeine
Agreeableness -> Cannabis
Agreeableness -> Chocolate
Agreeableness -> Cocaine
Agreeableness -> Crack
Agreeableness -> Ecstacy
Agreeableness -> Heroin
Agreeableness -> Ketamine
Agreeableness -> LSD
Agreeableness -> LegalHighs
Agreeableness -> Meth
Agreeableness -> Mushrooms
Agreeableness -> Nicotine
Agreeableness -> Semeron
Agreeableness -> VSA
Conscientiousness -> Alcohol
Conscientiousness -> Amphetamines
Conscientiousness -> AmylNitrate
Conscientiousness -> Benzos
Conscientiousness -> Caffeine
Conscientiousness -> Cannabis
Conscientiousness -> Chocolate
Conscientiousness -> Cocaine
Conscientiousness -> Crack
Conscientiousness -> Ecstacy
Conscientiousness -> Heroin
Conscientiousness -> Ketamine
Conscientiousness -> LSD
Conscientiousness -> LegalHighs
Conscientiousness -> Meth
Conscientiousness -> Mushrooms
Conscientiousness -> Nicotine
Conscientiousness -> Semeron
Conscientiousness -> VSA
Extraversion -> Alcohol
Extraversion -> Amphetamines
Extraversion -> AmylNitrate
Extraversion -> Benzos
Extraversion -> Caffeine
Extraversion -> Cannabis
Extraversion -> Chocolate
Extraversion -> Cocaine
Extraversion -> Crack
Extraversion -> Ecstacy
Extraversion -> Heroin
Extraversion -> Ketamine
Extraversion -> LSD
Extraversion -> LegalHighs
Extraversion -> Meth
Extraversion -> Mushrooms
Extraversion -> Nicotine
Extraversion -> Semeron
Extraversion -> VSA
Impulsiveness -> Alcohol
Impulsiveness -> Amphetamines
Impulsiveness -> AmylNitrate
Impulsiveness -> Benzos
Impulsiveness -> Caffeine
Impulsiveness -> Cannabis
Impulsiveness -> Chocolate
Impulsiveness -> Cocaine
Impulsiveness -> Crack
Impulsiveness -> Ecstacy
Impulsiveness -> Heroin
Impulsiveness -> Ketamine
Impulsiveness -> LSD
Impulsiveness -> LegalHighs
Impulsiveness -> Meth
Impulsiveness -> Mushrooms
Impulsiveness -> Nicotine
Impulsiveness -> Semeron
Impulsiveness -> VSA
Neuroticism -> Alcohol
Neuroticism -> Amphetamines
Neuroticism -> AmylNitrate
Neuroticism -> Benzos
Neuroticism -> Caffeine
Neuroticism -> Cannabis
Neuroticism -> Chocolate
Neuroticism -> Cocaine
Neuroticism -> Crack
Neuroticism -> Ecstacy
Neuroticism -> Heroin
Neuroticism -> Ketamine
Neuroticism -> LSD
Neuroticism -> LegalHighs
Neuroticism -> Meth
Neuroticism -> Mushrooms
Neuroticism -> Nicotine
Neuroticism -> Semeron
Neuroticism -> VSA
Openness -> Alcohol
Openness -> Amphetamines
Openness -> AmylNitrate
Openness -> Benzos
Openness -> Caffeine
Openness -> Cannabis
Openness -> Chocolate
Openness -> Cocaine
Openness -> Crack
Openness -> Ecstacy
Openness -> Heroin
Openness -> Ketamine
Openness -> LSD
Openness -> LegalHighs
Openness -> Meth
Openness -> Mushrooms
Openness -> Nicotine
Openness -> Semeron
Openness -> VSA
SensationSeeking -> Alcohol
SensationSeeking -> Amphetamines
SensationSeeking -> AmylNitrate
SensationSeeking -> Benzos
SensationSeeking -> Caffeine
SensationSeeking -> Cannabis
SensationSeeking -> Chocolate
SensationSeeking -> Cocaine
SensationSeeking -> Crack
SensationSeeking -> Ecstacy
SensationSeeking -> Heroin
SensationSeeking -> Ketamine
SensationSeeking -> LSD
SensationSeeking -> LegalHighs
SensationSeeking -> Meth
SensationSeeking -> Mushrooms
SensationSeeking -> Nicotine
SensationSeeking -> Semeron
SensationSeeking -> VSA
}
')

```
<h2> Plot it</h2>
```{r}
plot(graph)
```
```{r}
#paths(graph, "Agreeableness", "Ecstacy")
#dseparated(graph, "Agreeableness", "Ecstacy")
impliedConditionalIndependencies(graph)
```



```{r}
#chisq.test(df$Agreeableness, df$Ecstacy)

df2 <- df[,7:32]

df2[] <- lapply( df2, factor)

localTests(graph, df2)

```


```{r}
summary(lm( Ecstacy~Agreeableness,as.data.frame(scale(df2)) ) )
```